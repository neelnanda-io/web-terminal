<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mobile Terminal</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        /* Floating button bar */
        .button-bar {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 2px 20px rgba(0,0,0,0.5);
            z-index: 1000;
            max-width: 100%;
        }
        
        .btn {
            background: #333;
            border: 1px solid #555;
            color: #fff;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            flex-shrink: 0;
        }
        
        .btn:active {
            background: #222;
            transform: scale(0.95);
        }
        
        #terminal-frame {
            width: 100vw;
            height: 100vh;
            border: none;
            display: block;
        }
        
        .info {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(255, 255, 200, 0.9);
            color: #333;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 1001;
            text-align: center;
        }
        
        .hide-info {
            display: none;
        }
        
        /* Hidden textarea for clipboard operations */
        #clipboard-helper {
            position: absolute;
            left: -9999px;
            top: -9999px;
            width: 1px;
            height: 1px;
        }
        
        /* Feedback message */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 2000;
            display: none;
        }
        
        .feedback.show {
            display: block;
        }
    </style>
</head>
<body>
    <div id="info" class="info">
        ðŸ’¡ For Shift+Enter issue: Use Opt+Enter for newline. Buttons copy commands - paste with Cmd+V in terminal.
        <button onclick="document.getElementById('info').classList.add('hide-info')" style="margin-left: 10px; padding: 2px 8px; border-radius: 4px; border: 1px solid #666;">Ã—</button>
    </div>
    
    <iframe id="terminal-frame" src="/"></iframe>
    
    <div class="button-bar">
        <button class="btn" onclick="showKeyboard()">ðŸ“± Keyboard</button>
        <button class="btn" onclick="copyCommand('cd ~/Code')">ðŸ“‹ cd Code</button>
        <button class="btn" onclick="copyCommand('ls -la')">ðŸ“‹ ls -la</button>
        <button class="btn" onclick="copyCommand('tmux ls')">ðŸ“‹ tmux ls</button>
        <button class="btn" onclick="copyCommand('tmux new-window')">ðŸ“‹ tmux new</button>
        <button class="btn" onclick="copyCommand('clear')">ðŸ“‹ clear</button>
        <button class="btn" onclick="reloadTerminal()">ðŸ”„ Reload</button>
    </div>
    
    <textarea id="clipboard-helper"></textarea>
    <div id="feedback" class="feedback"></div>
    
    <script>
        // Improved copy function that works on all browsers
        function copyCommand(text) {
            const btn = event.target;
            const originalText = btn.textContent;
            
            // Method 1: Try modern clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showFeedback('Copied! Use Cmd+V to paste');
                    btn.textContent = 'âœ“ Copied!';
                    btn.style.background = '#2a5a2a';
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 1000);
                }).catch(err => {
                    // Fallback to method 2
                    fallbackCopy(text, btn, originalText);
                });
            } else {
                // Fallback for older browsers
                fallbackCopy(text, btn, originalText);
            }
        }
        
        // Fallback copy method using textarea
        function fallbackCopy(text, btn, originalText) {
            const textarea = document.getElementById('clipboard-helper');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '0';
            textarea.style.top = '0';
            textarea.style.width = '2em';
            textarea.style.height = '2em';
            textarea.style.padding = '0';
            textarea.style.border = 'none';
            textarea.style.outline = 'none';
            textarea.style.boxShadow = 'none';
            textarea.style.background = 'transparent';
            
            textarea.focus();
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showFeedback('Copied! Use Cmd+V to paste');
                    btn.textContent = 'âœ“ Copied!';
                    btn.style.background = '#2a5a2a';
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 1000);
                } else {
                    showFeedback('Select & copy: ' + text);
                }
            } catch (err) {
                console.error('Copy failed:', err);
                showFeedback('Select & copy: ' + text);
            }
            
            // Hide textarea again
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            textarea.style.top = '-9999px';
        }
        
        // Show feedback message
        function showFeedback(message) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.classList.add('show');
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);
        }
        
        // Try to trigger keyboard
        function showKeyboard() {
            const iframe = document.getElementById('terminal-frame');
            iframe.focus();
            
            // Try to click inside the iframe to trigger keyboard
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const terminal = iframeDoc.querySelector('.xterm-screen') || 
                               iframeDoc.querySelector('.xterm-helper-textarea') ||
                               iframeDoc.body;
                if (terminal) {
                    terminal.click();
                    terminal.focus();
                    
                    // Try to find and focus any input element
                    const inputs = iframeDoc.querySelectorAll('input, textarea');
                    if (inputs.length > 0) {
                        inputs[0].focus();
                    }
                }
                showFeedback('Tap in terminal to activate keyboard');
            } catch (e) {
                console.log('Cannot access iframe content');
                showFeedback('Tap in terminal to activate keyboard');
            }
        }
        
        // Reload the terminal
        function reloadTerminal() {
            showFeedback('Reloading...');
            document.getElementById('terminal-frame').src = '/';
        }
        
        // Auto-hide info after 15 seconds
        setTimeout(() => {
            document.getElementById('info').classList.add('hide-info');
        }, 15000);
        
        // Add keyboard shortcut info when page loads
        window.addEventListener('load', () => {
            console.log('Terminal Helper Loaded');
            console.log('Tip: Use Opt+Enter for newline in terminal');
            console.log('Tip: Click buttons to copy commands, then Cmd+V to paste');
        });
    </script>
</body>
</html>