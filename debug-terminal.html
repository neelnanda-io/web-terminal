<!DOCTYPE html>
<html>
<head>
    <title>Terminal Debug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>Terminal Debug</h1>
    <button onclick="testDirect()">Test Direct ttyd Connection</button>
    <button onclick="testProxied()">Test Proxied Connection</button>
    <button onclick="clearLog()">Clear Log</button>
    <pre id="log" style="background: #000; color: #0f0; padding: 10px; height: 400px; overflow: auto;"></pre>
    
    <script>
        const log = (msg) => {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toISOString().substr(11, 8);
            logEl.textContent += `[${timestamp}] ${msg}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        };
        
        const clearLog = () => {
            document.getElementById('log').textContent = '';
        };
        
        // Test direct connection to ttyd
        function testDirect() {
            log('Testing direct ttyd connection...');
            
            // First, let's try to connect directly to port 7681
            const ws = new WebSocket('ws://143.110.172.229:7681');
            
            ws.onopen = () => {
                log('✅ Direct connection opened!');
                ws.send('0echo "Hello from direct connection"\n');
            };
            
            ws.onmessage = (event) => {
                log(`Message: ${event.data}`);
            };
            
            ws.onerror = (error) => {
                log(`❌ Direct connection error`);
            };
            
            ws.onclose = (event) => {
                log(`Direct connection closed: ${event.code} - ${event.reason}`);
            };
        }
        
        // Test proxied connection through nginx
        function testProxied() {
            log('Testing proxied connection...');
            
            const ws = new WebSocket('ws://143.110.172.229/ws');
            
            ws.onopen = () => {
                log('✅ Proxied connection opened!');
                // Try different message formats
                log('Sending plain text...');
                ws.send('echo "Test 1"\n');
                
                setTimeout(() => {
                    log('Sending with 0 prefix...');
                    ws.send('0echo "Test 2"\n');
                }, 1000);
                
                setTimeout(() => {
                    log('Sending JSON resize...');
                    ws.send('1' + JSON.stringify({type: 'resize', cols: 80, rows: 24}));
                }, 2000);
            };
            
            ws.onmessage = (event) => {
                if (typeof event.data === 'string') {
                    log(`String message: ${event.data.substring(0, 100)}...`);
                } else {
                    log(`Binary message: ${event.data.byteLength} bytes`);
                }
            };
            
            ws.onerror = (error) => {
                log(`❌ Proxied connection error`);
            };
            
            ws.onclose = (event) => {
                log(`Proxied connection closed: ${event.code} - ${event.reason}`);
            };
        }
        
        // Also test if we can access ttyd's static resources
        fetch('/').then(r => {
            log(`Root page status: ${r.status}`);
        }).catch(e => {
            log(`Failed to fetch root: ${e.message}`);
        });
    </script>
</body>
</html>